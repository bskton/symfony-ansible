---
- name: Install nginx
  apt: name=nginx state=latest
  notify: restart nginx

- name: Copy nginx configuration for host
  template:
    src: www.conf
    dest: /etc/nginx/sites-available/www.conf
    owner: root
    group: root
    mode: 0644
  notify: restart nginx

- name: Create symlink for nginx configuration
  file: src=/etc/nginx/sites-available/www.conf
        dest=/etc/nginx/sites-enabled/default owner=root group=root state=link
  notify: restart nginx

- name: Install php-fpm
  apt: name=php-fpm state=latest
  notify:
    - restart php-fpm
    - restart nginx

- name: Copy php-fpm configuration for host
  copy: src=php.ini dest=/etc/php/7.0/fpm/ owner=root group=root mode=0644
  notify: restart php-fpm

- name: Install php-xdebug
  apt: name=php-xdebug state=latest

- name: Copy xdebug configuration file
  template:
    src: xdebug.ini
    dest: /etc/php/7.0/mods-available/xdebug.ini
    owner: root
    group: root
    mode: 0644
  notify: restart php-fpm

- name: Ð¡reate log directory if it doesn't exist
  file:
    path: /vagrant/log
    state: directory
    owner: "{{ admin_user }}"
    group: "{{ admin_user }}"
    mode: 0750

- name: Install PHPUnit
  copy:
    src: phpunit.phar
    dest: /usr/local/bin/phpunit
    owner: "{{ admin_user }}"
    group: "{{ admin_user }}"
    mode: 0555